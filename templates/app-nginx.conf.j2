server {
  listen 80;
  listen [::]:80;
  server_name {{ waj_domain_names | join(" ") }};
  client_max_body_size {{ waj_nginx_max_fileupload_size }};

  set_real_ip_from 0.0.0.0/0;
  real_ip_header X-Real-IP;
  real_ip_recursive on;

  location / {
    uwsgi_pass unix://{{ waj_uwsgi_socket }};
    include uwsgi_params;
    client_body_timeout {{ waj_nginx_client_body_timeout }};
    uwsgi_read_timeout 1200;
    {% if not waj_production %}
    # Deny all but the developers
    {% for ip in waj_developer_ips %}
    allow   {{ ip }};
    {% endfor %}
    deny    all;
    {% endif %}
  }

  location /static/ {
    alias {{ waj_project_path }}/{{ waj_project_title }}/static/;
    expires {{ waj_nginx_cache_static_files }};
  }
  location /media/ {
    alias {{ waj_project_path }}/{{ waj_project_title }}/media/;
    expires {{ waj_nginx_cache_static_files }};
  }
  location /static/admin/ {
    alias {{ waj_project_path }}/{{ waj_project_title }}/venv/lib/python3.7/site-packages/django/contrib/admin/static/admin/;
    expires {{ waj_nginx_cache_static_files }};
  }
  location /awstats/ {
    alias {{ waj_awstats_dir }}/;

    # Deny all but the developers
    {% for ip in waj_developer_ips %}
    allow   {{ ip }};
    {% endfor %}
    deny    all;

    # Authentication required
    auth_basic "Administratorâ€™s Area";
    auth_basic_user_file /etc/awstats/htpasswd.awstats;
  }

}